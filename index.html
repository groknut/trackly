
<!-- –ø–æ–¥–∫–ª—é—á–∞–µ–º Yandex –∫–∞—Ä—Ç—ã -->
<script src=""></script>

<!-- –ø–µ—Ä–≤—ã–π —Å–ª–∞–π–¥ - –≤—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã–π -->
<div id="title">

  <main>
    <h2>Trackly</h2>
    <p>–ü—Ä–æ–µ–∫—Ç –¥–ª—è —Å–±–æ—Ä–∞ —Å–≤–µ–¥–µ–Ω–∏–π –æ –º–µ—Å—Ç–∞—Ö –æ—Ç–¥—ã—Ö–∞ –¥–∏–∫–æ–≥–æ —Ç—É—Ä–∏–∑–º–∞ –Ω–∞ –ë–∞–π–∫–∞–ª–µ</p>

    <a class="link" href="#join">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</a>
    <a class="link" href="#about">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
  </main>

</div>

<!-- –≤—Ç–æ—Ä–æ–π —Å–ª–∞–π–¥ - –≤—ã–±–∏—Ä–∞–µ–º —Ç–æ—á–∫—É –Ω–∞ –∫–∞—Ä—Ç–µ -->
 <!-- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ -->
<div id="join" class="slide">

  <main>
    <h2>–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–æ –Ω–∞ –∫–∞—Ä—Ç–µ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—ë</h2>
    
    <div id="map"></div>

    <button id="to-join" class="but">–î–∞–ª—å—à–µ</button>
  </main>

</div>

<!-- —Ç—Ä–µ—Ç–∏–π —Å–ª–∞–π–¥ - –≤–≤–æ–¥–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ —Ç–∏–ø –º–µ—Å—Ç–Ω–æ—Å—Ç–∏. -->
 <!-- –í—Å–µ –ø–æ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π -->
<div id="setname" class="slide">

  <main>
    <h2>–≠—Ç–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–µ—Ç –Ω–∞ –∫–∞—Ä—Ç–µ. –ù–∞–∑–æ–≤–∏—Ç–µ –µ–≥–æ</h2>
    <input id="place-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—é–¥–∞" />

    <textarea id="desc" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ"></textarea>

    <span>
      <input id="cost" min="0" onkeydown="return event.key !== '-' && event.key !== '+' && event.key !== 'e'" placeholder="–°—Ç–æ–∏–º–æ—Å—Ç—å" type="number" value="0" />
      <select id="place_type" title="–¢–∏–ø –º–µ—Å—Ç–Ω–æ—Å—Ç–∏">
        <option>–õ–µ—Å</option>
        <option>–ì–æ—Ä—ã</option>
        <option>–†–∞–≤–Ω–∏–Ω—ã</option>
        <option>–•–æ–ª–º—ã</option>
        <option>–ü–µ—Å–æ—á–Ω—ã–π –ø–ª—è–∂</option>
        <option>–ö–∞–º–µ–Ω–∏—Å—Ç—ã–π –ø–ª—è–∂</option>
      </select>
    </span>

    <button id="to-comment" class="but">–í–∞—à–∏ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è</button>

  </main>

</div>

<!-- –ß–µ—Ç–≤–µ—Ä—Ç—ã–π —Å–ª–∞–π–¥ - –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∏ —Ä–µ–∞–∫—Ü–∏—è -->
<!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, —Ä–µ–∞–∫—Ü–∏—è - –Ω–µ—Ç -->
<div id="comment" class="slide">

  <main>
    <h2>–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º–∏ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è–º–∏</h2>
    <textarea id="text-comment" placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –Ω–∞–º –±–æ–ª—å—à–µ –æ–± —ç—Ç–æ–º –º–µ—Å—Ç–µ" required></textarea>

    <div class="reactions">

      <input id=like type='radio' name='reaction'>
      <label class="react" for="like">üî•</label>
      <input id=norm type='radio' name='reaction'>
      <label class="react" for="norm">üòê</label>
      <input id=fu type='radio' name='reaction'>
      <label class="react" for="fu">üíÄ</label>

    </div>

    <button id="to-photos" class="but">–¢–µ–ø–µ—Ä—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</button>
</p>


  </main>

</div>

<!-- –ü—è—Ç—ã–π —Å–ª–∞–π–¥ - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π -->
 <!-- –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ -->
<div id="photos" class="slide">

  <main>
    <h2>–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</h2>
    <p>–ü–æ –∂–µ–ª–∞–Ω–∏—é</p>
    
    <label class="custom-upload">
        <input type="file" id="photoUpload" multiple accept="image/*" />
        <span>Upload photo</span>
    </label>

    <button id="to-send" class="but">–ó–∞–∫–æ–Ω—á–∏–º?</button>


  </main>

</div>


<!-- –®–µ—Å—Ç–æ–π —Å–ª–∞–π–¥ - –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ #submit –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É -->
<div id="send" class="slide">

  <main>
    <h2 align="center">–í—Å—ë? –î–∞, —ç—Ç–æ —Ç–∞–∫!</h2>

    <button id="submit" class="but">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>

  </main>

</div>

<!-- –°–µ–¥—å–º–æ–π —Å–ª–∞–π–¥ - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
<div id="about">

  <main>
    <h2>–ü–æ–¥—Ä–æ–±–Ω–µ–µ</h2>
    <div id="map_about"></div>
    <p>–ù–∞–¥ –ø—Ä–æ–µ–∫—Ç–æ–º `Trackly` —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç—É–¥–µ–Ω—Ç—ã –ø–æ –∑–∞–∫–∞–∑—É –ò–Ω—Å—Ç–∏—Ç—É—Ç–∞ –¥–∏–Ω–∞–º–∏–∫–∏ —Å–∏—Å—Ç–µ–º –∏ —Ç–µ–æ—Ä–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–º–µ–Ω–∏ –í.–ú. –ú–∞—Ç—Ä–æ—Å–æ–≤–∞ –°–û –†–ê–ù.</p>
    <span>
      <a class="link" href="#actual">–ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö</a>
    </span>

  </main>

</div>

<!-- –í–æ—Å—å–º–æ–π —Å–ª–∞–π–¥ - —Ñ–æ—Ä–º–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–∑–º–µ–Ω–Ω–µ–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö -->
<div id="actual" class="slide">

  <main>
    <h2>–ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:</h2>
    
    <p>–ú—ã —Å—Ç–∞—Ä–∞–µ–º—Å—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –ï—Å–ª–∏ –≤—ã –Ω–∞—à–ª–∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ, —Ç–æ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –Ω–∏–∂–µ</p>

    <input list="title-values" id="mode-title" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞">
    <datalist id="title-values"></datalist>

    <input id="mode-cost" min="0" onkeydown="return event.key !== '-' && event.key !== '+' && event.key !== 'e'" placeholder="–°—Ç–æ–∏–º–æ—Å—Ç—å" type="number" value="0"/>

    <span>
      <button id="sub" class="but">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      <a class="link" href="#title">–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</a>
    </span>

  </main>

</div>

<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —à—Ä–∏—Ñ—Ç Jost -->

<style>
  @import url('https://fonts.googleapis.com/css2?family=Jost:ital,wght@0,100..900;1,100..900&display=swap');
</style>


<!-- –°—Ç–∏–ª–∏ -->
<style>

/* 2 –≥–ª–∞–≤–Ω—ã—Ö —Ü–≤–µ—Ç–∞ */
:root
{
  --txt-color: #f0f0f0;
  --bgcolor: #100f0f;
}
/* –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏ –∫–æ –≤—Å–µ–º—É, –∫—Ä–æ–º–µ —Ç–µ–≥–æ–≤ ymaps –∏ –∏—Ö –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–Ø–Ω–¥–µ–∫—Å –∫–∞—Ä—Ç) */
*:not(ymaps):not(ymaps *)
{
  font-family: 'Jost';
  color: var(--txt-color);
  background-color: var(--bgcolor);
}

/* –∑–∞–¥–∞–µ–º —Ü–≤–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –≤—Å–µ–º —ç–ª–µ–º–µ–Ω—Ç–∞–º */
::selection
{
color: var(--bgcolor);
background-color: var(--txt-color);
}

/* –°—Ç–∏–ª—å –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω–æ–π —Ñ–æ—Ä–º—ã */
/* !important –ø–æ–≤—ã—à–∞–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞—à–∏—Ö —Å—Ç–∏–ª–µ–π –Ω–∞–¥ —Å—Ç–∏–ª—è–º–∏ Google Apps Script */
html {
scroll-behavior:smooth !important;
overflow-y:hidden !important;
min-height: 100%;
}

/* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ html, body */
html, body
{
  width: 100% !important;
  height: 100% !important;
  margin: 0 !important;
  padding: 0 !important;
}

body
{
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* —Å—Ç–∏–ª–∏ —Å–ª–∞–π–¥–æ–≤ */
.slide, #about, #title
{
  min-height: 100% !important;
  max-height: 100% !important;
  min-width: 500px !important;
  max-width: 500px !important;
  display: flex !important;
  justify-content: center !important;
  align-items: center !important;
}

/* —Å—Ç–∏–ª—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –±–ª–æ–∫–∞ –≤ —Å–ª–∞–π–¥–µ */
main
{
  display: flex;
  width: 100%;
  flex-direction: column;
  align-items: center;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã */

/* –Ω–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞, –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –æ—Ç–∑—ã–≤ */
#place-name, #desc, #text-comment, #mode-title
{
  border: none;
  padding: 10px;
  width: 100%;
}

/* –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –æ—Ç–∑—ã–≤ */
#desc, #text-comment
{
  margin: 20px 0;
  height: 200px;
  resize: none;
}

/* –Ω–∞–≤–µ–¥–µ–Ω–∏–µ */
#place_type:hover, .custom-upload:hover, .react:hover, .but:hover, .link:hover, span > a:hover
{
  cursor: pointer;
}

.link:hover, span > a:hover, .but:hover
{
    color: var(--bgcolor);
    background-color: var(--txt-color);
}

/* —Å—Ç–æ–∏–º–æ—Å—Ç—å */
#cost, #mode-cost
{
  width: 200px;
  outline: none;
}

/* —Ç–∏–ø –º–µ—Å—Ç–Ω–æ—Å—Ç–∏ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å */
#place_type, #cost, #mode-cost
{
  padding: 5px;
  border-radius: 5px;
  border: 2px solid var(--txt-color);
}

/* —É–±–∏—Ä–∞–µ–º spin-button */
#cost::-webkit-inner-spin-button, #mode-cost::-webkit-inner-spin-button {
  -webkit-appearance: none;
}

#cost, #mode-cost
{
  -moz-appearance: textfield;
}

/* –±–ª–æ–∫–∏, –∫ –∫–æ—Ç–æ—Ä—ã–º –º—ã –ø–æ–¥–≥—Ä—É–∂–∞–µ–º –∫–∞—Ä—Ç—É */
#map,  #map_about
{
  width: 640px;
  height: 480px;
}

/* –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */
.custom-upload > input[id="photoUpload"]
{
  display: none;
}

.custom-upload
{
  background: var(--bgcolor);
  padding: 10px;
  margin: 20px 10px;
  width: 100%;
  border: 1px dashed var(--txt-color);
  opacity: 80%;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100px;
}

/* —Ä–µ–∞–∫—Ü–∏–∏ */
input[type="radio"]
{
  display: none;
}

.react
{
  font-size: 20pt;
  margin: 0 15px;
  padding: 8px;
  transition: border 0.3 ease;
  border: 1px solid transparent;
}

input[type="radio"]:checked + label
{
  border: 2px solid var(--txt-color);
}


/* –∫–Ω–æ–ø–∫–∏ –∏ —Å—Å—ã–ª–∫–∏ */
.link {
  width: 200px;
  height: 40px;
  text-decoration: none;
  display: flex;
  margin-top: 10px;
  justify-content: center;
  align-items: center;
} 

.but
{
  width: 204px;
  height: 44px;
  margin-top: 20px;
  padding: 0;
}

.link, .but
{
  border-radius: 5px;
  transition: background-color 0.5s ease, color 0.5s ease;
  border: 2px solid var(--txt-color);
}

/* —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –∏ —Å—Ç–∏–ª–∏ —Ç–µ–∫—Å—Ç–∞ */

h2, p
{
  width: 100%;
}

p, a, .but, #desc, #place_type, #cost, #place-name, #text-comment, #mode-title, #mode-cost
{
  font-size: 1em;
}

h2
{
  font-size: 1.5em;
}

#mode-title
{
  margin-bottom: 15px;
}

</style>

<!-- —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (max-width: 1000px) -->

<style>

@media screen and (max-width: 1000px) {

  /* —Å—Ç–∏–ª–∏ —Å–ª–∞–π–¥–æ–≤ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –±–ª–æ–∫–∞ */

  .slide, #about, #title {
    min-width: 100% !important;
    max-width: 100% !important;
    padding: 20px !important;
    box-sizing: border-box;
  }

  main {
    padding: 10px;
  }

  /* –£–º–µ–Ω—å—à–∞–µ–º –∫–∞—Ä—Ç—ã */
  #map, #map_about {
    width: 90%;
    height: 1000px;
  }

  /* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
  #place-name, #desc, #text-comment, #mode-title {
    width: 90%;
    padding: 20px;
  }

  #place-name:focus, #desc:focus, #text-comment:focus, #mode-title:focus
  {
    border: 4px solid var(--txt-color);
  }

  #desc, #text-comment
  {
    height: 400px  
  }

  /* –ê–¥–∞–ø—Ç–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ */
  .link {
    width: 600px;
    height: 100px;
    text-decoration: none;
    display: flex;
    margin-top: 30px;
    justify-content: center;
    align-items: center;
  } 

  .but
  {
    width: 604px;
    height: 104px;
    margin-top: 40px;
    padding: 0;
  }

  /* –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º –±–ª–æ–∫ —Å —Ü–µ–Ω–æ–π –∏ —Ç–∏–ø–æ–º –º–µ—Å—Ç–∞ */
  span {
    display: flex;
    width: 90%;
    flex-direction: column;
    align-items: center;
  }

  #cost, #mode-cost
  {
    width: 90%;
  }

  #place_type
  {
    width: 100%;
  }

  #cost, #place_type, #mode-cost {
    margin: 20px 0;
    padding: 10px;
    height: 150px;
  }


  /* –£–ª—É—á—à–∞–µ–º —Ä–µ–∞–∫—Ü–∏–∏ */
  .reactions {
    width: 100%;
    display:flex;
    justify-content: center;
  }

  .react {
    margin: 0 30px;
    padding: 16px;
  }

  /* –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ */
  .custom-upload {
    width: 90%;
    height: 400px;
  }

  /* –¢–µ–∫—Å—Ç —Ä–∞—Å–ø–æ–ª–∞–≥–∞–µ–º –ø–æ —Ü–µ–Ω—Ç—Ä—É */
  h2, p {
    text-align: center;
  }

  /* –ú–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —à—Ä–∏—Ñ—Ç–∞ */
  .react {font-size: 6em;}
  .custom-upload, h2, #cost, #place_type, #mode-cost {font-size: 4em;}
  a {font-size: 1em;}
  #place-name, #mode-title, .link, .but {font-size: 3em;}
  #desc, #text-comment, p {font-size: 2.5em;}

}

</style>

<!-- –ó–¥–µ—Å—å —É–∂–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å js –∏ —Ä–∞–±–æ—Ç–∞ —Å —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —á–∞—Å—Ç—å—é -->

<!-- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ -->
<script>
  document.querySelector(".custom-upload input").addEventListener(
  "change", function(e)
  {
    const fileName = e.target.files.length ? `Upload ${e.target.files.length} files` : "Upload photo";
    this.parentElement.querySelector('span').textContent = fileName;
  }
);
</script>

<!-- –æ–±—ä—è–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ —Ä–∞–±–æ—Ç–∞–µ–º -->
<script>
  // –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
  let [place_name, comment, acoords, place_type, cost, description] = Array(6).fill(null);
  // –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
  let reaction = null; // —Ä–µ–∞–∫—Ü–∏–∏
  let photos = []; // –º–∞—Å—Å–∏–≤, –≤ –∫–æ—Ç–æ—Ä—ã–π —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
  let relevance = 0; // relevance = 0, –∑–Ω–∞—á–∏—Ç –º–µ—Å—Ç–æ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

</script>

<!-- —Ä–∞–±–æ—Ç–∞ —Å –∫–∞—Ä—Ç–∞–º–∏ –Ω–∞ –≤—Ç–æ—Ä–æ–º —Å–ª–∞–π–¥–µ #join -->
<script>
ymaps.ready(init);

let coords = null;
let targetCoords = null;
let placeGlobal = null;

function init() {
  const map = new ymaps.Map("map", {
    center: [53.405327, 107.673049],
    zoom: 6,
    controls: ["zoomControl"]
  });



  google.script.run
    .withSuccessHandler(function(data) {
      for (let place of data) {
        data_coords = [place[1], place[2]];
        const placemark = new ymaps.Placemark(data_coords, {
          balloonContentHeader: place[0],
          balloonContentBody: `<b>–û–ø–∏—Å–∞–Ω–∏–µ:</b> ${place[3]}<br> <b>–°—Ç–æ–∏–º–æ—Å—Ç—å:</b> ${place[4]} —Ä—É–±–ª–µ–π`,
          hintContent: place[0],
        }, {
          preset: 'islands#redDotIcon',
          draggable: false
        });
        
        placemark.events.add('click', function(e) {
          if (placeGlobal) {
            map.geoObjects.remove(placeGlobal);
          }
          targetCoords = e.get('target').geometry.getCoordinates();
          place_name = place[0];
          cost = place[5];
          description = place[4];
          coords = null;
        });
        map.geoObjects.add(placemark);
      }
    })
    .getPlaceList();

  map.events.add('click', function(e) {
    map.balloon.close();
    targetCoords = null;
    if (placeGlobal) {
      map.geoObjects.remove(placeGlobal);
    }
    coords = e.get('coords');
    placeGlobal = new ymaps.Placemark(coords, 
    {
      balloonContent: 'Where',
      hintContent: 'Where',
    }, {
    preset: 'islands#redDotIcon',
    draggable: false
  });
    map.geoObjects.add(placeGlobal);
  });
}

</script>

<!-- —Ä–∞–±–æ—Ç–∞ —Å –∫–∞—Ä—Ç–∞–º–∏, –≥–¥–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è -->

<script>
  ymaps.ready(init);
  function init() {
  const map2 = new ymaps.Map("map_about", {
    center: [53.405327, 107.673049],
    zoom: 6,
    controls: ["zoomControl"]
  });

  google.script.run
    .withSuccessHandler(function(data) {
      for (let place of data) {
        data_coords = [place[1], place[2]];
        const placemark = new ymaps.Placemark(data_coords, {
          balloonContentHeader: place[0],
          balloonContentBody: `<b>–û–ø–∏—Å–∞–Ω–∏–µ:</b> ${place[3]}<br> <b>–°—Ç–æ–∏–º–æ—Å—Ç—å:</b> ${place[4]} —Ä—É–±–ª–µ–π`,
          hintContent: place[0],
        }, {
          preset: 'islands#redDotIcon',
          draggable: false
        });
        
        placemark.events.add('click', function(e) {
          if (placeGlobal) {
            map2.geoObjects.remove(placeGlobal);
          }
          targetCoords = e.get('target').geometry.getCoordinates();
          place_name = place[0];
        });
        map2.geoObjects.add(placemark);
      }
    })
    .getPlaceList();
}
</script>

<!-- –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª–µ–π -->
<script>

  document.getElementById("to-join").addEventListener(
  "click", function(e)
  {
    if (coords != null && targetCoords == null)
    {
      window.location.hash = "#setname";
      acoords = coords;
    } 
    else if (targetCoords != null && coords == null)
    {
      window.location.hash = "#comment";
      acoords = targetCoords;
      relevance = 0;
    }
    else if(targetCoords == null && coords == null)
    {
      alert("–¢–æ—á–∫–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—á–∫—É –Ω–∞ –∫–∞—Ä—Ç–µ.");
      return;
    }

  }

);

document.getElementById("to-comment").addEventListener("click", function(e){
    place_name = document.getElementById("place-name").value.trim();
    cost = Number(document.getElementById("cost").value);
    description = document.getElementById("desc").value.trim();
    place_type = document.getElementById("place_type").value;
    relevance = 1;
    
    if(place_name && cost >= 0 && description)
      window.location.hash = "#comment";
    else
    {
      if(!place_name)
      {
        alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞!");
        return;
      }
      else if(cost < 0)
      {
        alert("–í–≤–µ–¥–∏—Ç–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å!");
        return;
      }
      else if(!description)
      {
        alert("–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ—Å—Ç–∞!");
        return;
      }
    }
  });


  document.getElementById("to-photos").addEventListener("click", function(e){
    comment = document.getElementById("text-comment").value.trim();
    reaction = document.querySelector("input[name='reaction']:checked");
    reaction = reaction ? reaction.id : null
    
    if(comment)
      window.location.hash = "#photos";
    else
    {
      alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π!");
      return;
    }
  });

  document.getElementById("to-send").addEventListener("click", function(e){
    window.location.hash = "#send";
  });

  document.getElementById("submit").addEventListener("click", function(e){
     // –∑–¥–µ—Å—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫

    if (relevance)
  {
    // –≤ –ª–∏—Å—Ç place —Å–æ—Ö—Ä–∞–Ω—è–µ–º place_name, acoords[0], acoords[1], description, id —Ç–∏–ø–∞ –º–µ—Å—Ç–Ω–æ—Å—Ç–∏
// –≤ checking —Å–æ—Ö—Ä–∞–Ω—è–µ–º id –º–µ—Å—Ç–∞ –æ—Ç–¥—ã—Ö–∞, timestamp, cost, relevance
// –≤ comment id –º–µ—Å—Ç–∞ –æ—Ç–¥—ã—Ö–∞, id —Ä–µ–∞–∫—Ü–∏–∏ (–µ—Å–ª–∏ –Ω–µ—Ç, —Ç–æ 4), comment –∏ url —Ñ–æ—Ç–æ (—Ö–æ—Ç—è –Ω–µ –∑–Ω–∞—é, –º–æ–∂–µ—Ç –Ω–µ –Ω–∞–¥–æ —ç—Ç–æ –Ω–∞–º. –í—Å–µ —Ä–∞–≤–Ω–æ –¥–µ–ª–∞–µ–º –ø–∞–ø–∫—É —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è)
  }

  else
  {
    // –≤ –ª–∏—Å—Ç place —Å–æ—Ö—Ä–∞–Ω—è–µ–º place_name, acoords[0], acoords[1], description, id —Ç–∏–ø–∞ –º–µ—Å—Ç–Ω–æ—Å—Ç–∏
// –≤ comment id –º–µ—Å—Ç–∞ –æ—Ç–¥—ã—Ö–∞, id —Ä–µ–∞–∫—Ü–∏–∏ (–µ—Å–ª–∏ –Ω–µ—Ç, —Ç–æ 4), comment –∏ url —Ñ–æ—Ç–æ (—Ö–æ—Ç—è –Ω–µ –∑–Ω–∞—é, –º–æ–∂–µ—Ç –Ω–µ –Ω–∞–¥–æ —ç—Ç–æ –Ω–∞–º. –í—Å–µ —Ä–∞–≤–Ω–æ –¥–µ–ª–∞–µ–º –ø–∞–ø–∫—É —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è)
  }

  });

</script>


<!-- —Ñ–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
<script>

const mode_title = document.getElementById('mode-title');
const datalist = document.getElementById('title-values');
let placeData = [];

google.script.run.withSuccessHandler(function(data)
{placeData = data;}).getPlaceNameList();


 
document.addEventListener('DOMContentLoaded', function() {
  
  if (!Array.isArray(placeData)) {
    console.error('–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –º–∞—Å—Å–∏–≤–æ–º');
    return;
  }

  // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ datalist
  updateDatalist(placeData, '');

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
  mode_title.addEventListener('input', function() {
    updateDatalist(placeData, this.value.toLowerCase());
  });


  function updateDatalist(data, filterText) {
    datalist.innerHTML = '';
    data.filter(item => 
      item && item.toLowerCase().includes(filterText)
    ).forEach(item => {
      const option = document.createElement('option');
      option.value = item;
      datalist.appendChild(option);
    });
  }
});



  document.getElementById("sub").addEventListener("click", function(e){
    const name = document.getElementById("mode-title").value.trim();
    const newCost = Number(document.getElementById("mode-cost").value);
    const timestamp = new Date().getTime();

    if (!placeData.includes(name) || !name || newCost < 0)
    {
      alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!");
      return;
    }

    google.script.run.withSuccessHandler(function(placeId) {
      if (placeId) {
        google.script.run.withSuccessHandler(function(result) {
          console.log("–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã", result);
        }).addEntryChecking([placeId, timestamp, newCost, 0]);
      }
    }).withFailureHandler((error) => {
        alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: " + error.message);
      }).getPlaceId(name);
    alert("–°–ø–∞—Å–∏–±–æ –∑–∞ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é!");
    window.location.hash = "#title";
  });
</script>

<!-- —Ç–µ–º–Ω–∞—è/—Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞. –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±—Ä–∞—É–∑–µ—Ä–∞ -->
<script>

  function applyTheme()
  {
    const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

    const root = document.documentElement;

    if (isDark)
    {
      root.style.setProperty('--bgcolor', "#100f0f");
      root.style.setProperty('--txt-color', "#f0f0f0");
    }
    else
    {
      {
      root.style.setProperty('--bgcolor', "#f0f0f0");
      root.style.setProperty('--txt-color', "#100f0f");
    }
    }

  }

  document.addEventListener('DOMContentLoaded', applyTheme);

  window.matchMedia('(prefers-color-scheme: dark)').addEventListener(
    'change', applyTheme
  );

</script>

<!-- –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö -->
<script>
  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –∫–∞–∫ base64 —Å—Ç—Ä–æ–∫–∏
  function readFileAsBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => {
        if (reader.result) {
          const base64String = reader.result.split(',')[1];
          resolve({
            fileName: file.name,
            mimeType: file.type,
            base64Content: base64String
          });
        } else {
          reject(new Error("FileReader result is null"));
        }
      };
      reader.onerror = (error) => reject(error);
      reader.readAsDataURL(file);
    });
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
  const mainSubmitButton = document.getElementById('submit'); // –ù–∞—Ö–æ–¥–∏–º –∫–Ω–æ–ø–∫—É –ø–æ ID

  if (mainSubmitButton) { // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞–π–¥–µ–Ω–∞ –ª–∏ –∫–Ω–æ–ø–∫–∞
    mainSubmitButton.addEventListener('click', function() {
      const submitButtonRef = this; // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–æ–ø–∫—É
      submitButtonRef.disabled = true;
      submitButtonRef.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';

      console.log("–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ window.cost –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π:", cost, "(–¢–∏–ø:", typeof cost + ")");

      // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö JavaScript –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö,
      const formData = {
        placeName: place_name,       // –ò—Å–ø–æ–ª—å–∑—É–µ–º window. –¥–ª—è —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
        description: description,
        cost: cost,
        place_type: place_type,
        acoords: acoords,           // –ú–∞—Å—Å–∏–≤ [lat, lon]
        comment: comment,
        reaction: reaction,         // –£–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç id —Ä–µ–∞–∫—Ü–∏–∏ –∏–ª–∏ null
        relevance: relevance        // 0 –∏–ª–∏ 1
      };

      const filesDataArray = photos; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤ photos

      console.log("–û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞. formData:", JSON.stringify(formData));
      console.log("–û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞. photos:", filesDataArray ? filesDataArray.length : 0);
      // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é Google Apps Script
      google.script.run
        .withSuccessHandler(function(response) {
          console.log("–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ (–æ—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞):", response);

          // –û—á–∏—Å—Ç–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
          place_name = '';
          comment = '';
          acoords = '';
          place_type = '';
          cost = 0; 
          description = '';
          reaction = '';
          photos = [];
          relevance = 0;

          // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
  
          const placeNameInput = document.getElementById('place-name');
          if (placeNameInput) placeNameInput.value = '';
          const textCommentInput = document.getElementById('text-comment');
          if (textCommentInput) textCommentInput.value = '';
          const costInput = document.getElementById('cost');
          if (costInput) costInput.value = '0'; // –∏–ª–∏ ''
          const descInput = document.getElementById('desc');
          if (descInput) descInput.value = '';
          const placeTypeSelect = document.getElementById('place_type');
          if (placeTypeSelect) placeTypeSelect.selectedIndex = 0;

          const reactionRadios = document.querySelectorAll('input[name="reaction"]');
          reactionRadios.forEach(radio => { radio.checked = false; });

          const photoUploadInput = document.getElementById('photoUpload');
          if (photoUploadInput) photoUploadInput.value = null;
          const customUploadSpan = document.querySelector(".custom-upload span");
          if (customUploadSpan) customUploadSpan.textContent = "Upload photo";

          window.location.hash = '#title'; // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
          submitButtonRef.disabled = false;
          submitButtonRef.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å';
        })
        .withFailureHandler(function(error) {
          alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ: ' + error.message);
          console.error('–û—à–∏–±–∫–∞ GS (–æ—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞):', error);
          submitButtonRef.disabled = false;
          submitButtonRef.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å';
        })
        .processFormData(formData, filesDataArray); // –ü–µ—Ä–µ–¥–∞–µ–º formData –∏ –º–∞—Å—Å–∏–≤ —Ñ–æ—Ç–æ
    });
  } else {
    console.error("–ö–Ω–æ–ø–∫–∞ —Å id='submit' –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ—Ä–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!");
  }

  const toSendButton = document.getElementById("to-send");
  if (toSendButton) {
      toSendButton.addEventListener("click", function(e){
        const photoUploadInput = document.getElementById('photoUpload');
        const files = photoUploadInput.files;
        const fileDataPromises = [];
        photos = []; // –û—á–∏—â–∞–µ–º –º–∞—Å—Å–∏–≤ –ø–µ—Ä–µ–¥ –Ω–æ–≤—ã–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º

        if (files.length > 0) {
          if (files.length > 10) {
            alert('–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ –±–æ–ª–µ–µ 10 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π.');
            return; // –ù–µ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –¥–∞–ª—å—à–µ
          }
          for (let i = 0; i < files.length; i++) {
            fileDataPromises.push(readFileAsBase64(files[i]));
          }

          Promise.all(fileDataPromises)
            .then(filesDataArray => {
              photos = filesDataArray; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ –≥–ª–æ–±–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤
              console.log("–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ photos:", photos.length);
              window.location.hash = "#send"; // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —Å–ª–∞–π–¥ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–æ—Ç–æ
            })
            .catch(error => {
              alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–æ–≤: ' + error.message);
              console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤:', error);
            });
        } else {
          console.log("–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ #send.");
          window.location.hash = "#send"; // –ï—Å–ª–∏ —Ñ–æ—Ç–æ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã, –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –¥–∞–ª—å—à–µ
        }
      });
  }
</script>


































